<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Snow Rider 3D</title>
</head>

<body>
    <div>
        <a id="home" href="../"><button><i class="fa fa-home fa-lg"></i></button></a>
    </div>
    <div>
        <button id="settings"><i class="fa fa-gear fa-lg"></i></button>
    </div>
    
    <div id="settings-content" style="display: none; margin-top: 15px; text-align: center;">
        <form action="" id="theForm">
            <label for="width">width: </label>
            <input value="960" size="3" type="text" id="width" name="width">
            <label for="height">height: </label>
            <input value="600" size="3" type="text" id="height" name="height">
            <input style="cursor: pointer;" type="submit" value="set" id="submit-btn">
        </form>
    </div>

    <div style="margin-top: 25px; text-align: center; color:white; font-family: sans-serif;">
        <span id="fps"></span>
    </div>

    <iframe id="frame" src="game.html" height="600px" width="960px"></iframe>
    <div style="text-align: center;">
        <a href="./game.html"><button title="Open game directly"><i class="fa fa-external-link fa-lg"></i></button></a>
        <button id="fullscreen-btn" title="Enter fullscreen" onclick="toggleFullScreen();"><i class="fa fa-expand fa-lg"></i></button>
    </div>
</body>

<script>
    const form = document.getElementById("theForm"),
        frame = document.getElementById("frame"),
        btn = document.getElementById("settings"),
        settings = document.getElementById("settings-content");

    frame.focus();

    form.addEventListener("submit", function(e) {
        var width = form.elements["width"].value,
            height = form.elements["height"].value;

        frame.style.width = width + "px";
        frame.style.height = height + "px";
    
        e.preventDefault();
    });

    document.addEventListener(
    "keydown",
    (e) => {
        if (e.keyCode === 82) {
        //location.reload();
        frame.reload();
        }
    },
    false,
    );

    btn.onclick = function() {
        if (settings.style.display === "none") {
            settings.style.display = "block"
        } else {
            settings.style.display = "none"
        }
    };

    function fpsMeter() {
        let prevTime = Date.now(),
            frames = 0;

        requestAnimationFrame(function loop() {
        const time = Date.now();
        frames++;
        if (time > prevTime + 100) {
            let fps = (( frames * 1000 ) / ( time - prevTime )).toFixed(2);
            prevTime = time;
            frames = 0;

            if (fps > 65) {
                document.getElementById("fps").innerHTML = `FPS: ${fps}<br>Your current frame rate is too high! Please set your FPS to 60)`;
            } else {
                document.getElementById("fps").innerHTML = `Current FPS: ${fps}<br><br>`;
            }
        }

        requestAnimationFrame(loop);
        });
    }

    function toggleFullScreen() {
        if (!document.fullscreenElement) {
            frame.requestFullscreen();
        } else if (document.exitFullscreen) {
            document.exitFullscreen();
        }
    }

    document.addEventListener(
    "keydown",
    (e) => {
        if (e.keyCode === 70) {
        toggleFullScreen();
        }
    },
    false,
    );

    fpsMeter();
</script>

</html>